<html>

  <head></head>
  <body>
    <div id="container">
      <canvas id="image" width="625" height="500"></canvas>
      <canvas id="overlay" width="625" height="500"></canvas>
    </div>
    <!-- <img id="ali" src="faces/ali.png" alt="Ali's Face" style="margin:40px">
    <img id="kyle" src="faces/kyle.png" alt="Kyle's Face" style="margin:40px">
    <img id="natalie" src="faces/natalie.png" alt="Natalie's Face" style="margin:40px"> -->
    <script src="js/clmtrackr.js"></script>
    <script src="js/model_pca_20_svm.js"></script>
    <script src="js/p5.js"></script>
    <script src="js/p5.dom.js"></script>
  </body>
  <script>
    // var ctracker;
    // var cnv2;
    var status = false;
    var cc = document.getElementById('image').getContext('2d');
		var overlay = document.getElementById('overlay');
		var overlayCC = overlay.getContext('2d');
		var img = new Image();
		img.onload = function() {
			cc.drawImage(img,0,0,625, 500);
      status = true;
		};
		img.src = 'faces/ali.png';
		var ctrack = new clm.tracker({stopOnConvergence : true});
		ctrack.init();

		var drawRequest;
		function animateClean() {
			ctrack.start(document.getElementById('image'));
			drawLoop();
		}
		function animate(box) {
			ctrack.start(document.getElementById('image'), box);
			drawLoop();
		}
		function drawLoop() {
			drawRequest = requestAnimationFrame(drawLoop);
			overlayCC.clearRect(0, 0, 720, 576);
			if (ctrack.getCurrentPosition()) {
				ctrack.draw(overlay);
			}
		}
    if (status == true){
      console.log(status);
      animateClean();
    }

    // detect if tracker fails to find a face
    document.addEventListener("clmtrackrNotFound", function(event) {
    	ctrack.stop();
    	alert("The tracking had problems with finding a face in this image. Try selecting the face in the image manually.")
    }, false);
    // detect if tracker loses tracking of face
    document.addEventListener("clmtrackrLost", function(event) {
    	ctrack.stop();
    	alert("The tracking had problems converging on a face in this image. Try selecting the face in the image manually.")
    }, false);
    // detect if tracker has converged
    document.addEventListener("clmtrackrConverged", function(event) {
    	document.getElementById('convergence').innerHTML = "CONVERGED";
    	document.getElementById('convergence').style.backgroundColor = "#00FF00";
    	// stop drawloop
    	cancelRequestAnimFrame(drawRequest);
    }, false);
      // function setup() {
      //
      //   // setup camera capture
      //   var videoInput = createCapture(VIDEO);
      //   videoInput.size(400, 300);
      //   videoInput.position(0 , 300);
      //
      //   // setup canvas
      //   var cnv = createCanvas(400, 300);
      //   cnv.position(0, 300);
      //
      //   cnv2 = createGraphics(400, 300);
      //   cnv2.position(400, 300);
      //
      //   // setup tracker
      //   ctracker = new clm.tracker();
      //   ctracker.init(pModel);
      //   ctracker.start(videoInput.elt);
      //
      //   noStroke();
      // }
      //
      // function draw() {
      //   clear();
      //   cnv2.background(100);
      //
      //   // get array of face marker positions [x, y] format
      //   var positions = ctracker.getCurrentPosition();
      //   //console.log(positions);
      //   // set the color of the ellipse based on position on screen
      //   // push();
      //   // // draw ellipse at each position point
      //   // if (positions){
      //   //   stroke('red');
      //   //   strokeWeight(4);
      //   //   fill('red');
      //   //   //33 is between eyebrows
      //   //   ellipse(positions[35][0], positions[35][1], 8, 8);
      //   //   ellipse(positions[39][0], positions[39][1], 8, 8);
      //   //
      //   //   line(positions[33][0], positions[33][1],positions[35][0], positions[35][1]);
      //   //   line(positions[33][0], positions[33][1],positions[39][0], positions[39][1]);
      //   //
      //   //   line(positions[35][0], positions[35][1],positions[39][0], positions[39][1]);
      //   //
      //   //   line(positions[35][0], positions[35][1],positions[44][0], positions[44][1]);
      //   //   line(positions[39][0], positions[39][1],positions[50][0], positions[50][1]);
      //   //
      //   //
      //   //   //ellipse(positions[50][0], positions[50][1], 8, 8);
      //   //   //line(positions[44][0], positions[44][1],positions[50][0], positions[50][1]);
      //   //   let num = dist(positions[44][0], positions[44][1],positions[50][0], positions[50][1]);
      //   //   //console.log(num);
      //   // }
      //   // // 44 is left corner of mouth
      //   // // 50 is right corner of mouth
      //   // pop();
      //
      //   for (var i=0; i<positions.length; i++) {
      //     // set the color of the ellipse based on position on screen
      //     fill(map(positions[i][0], width*0.33, width*0.66, 0, 255), map(positions[i][1], height*0.33, height*0.66, 0, 255), 255);
      //     // draw ellipse at each position point
      //     ellipse(positions[i][0], positions[i][1], 5, 5);
      //   }

      //}
    </script>

</html>
